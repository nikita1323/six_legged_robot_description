<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <!-- Hip joint properties: displacement and rotation relative to the base frame -->
    <xacro:property name="hip_1_xyz" value="0.172664 0.092664 0.023" />
    <xacro:property name="hip_1_rpy" value="0 0 ${pi/4}" />
    <xacro:property name="hip_2_xyz" value="0.172664 -0.092664 0.023" />
    <xacro:property name="hip_2_rpy" value="0 0 ${-pi/4}" />
    <xacro:property name="hip_3_xyz" value="0 0.12191 0.023" />
    <xacro:property name="hip_3_rpy" value="0 0 ${pi/2}" />
    <xacro:property name="hip_4_xyz" value="0 -0.12191 0.023" />
    <xacro:property name="hip_4_rpy" value="0 0 ${-pi/2}" />
    <xacro:property name="hip_5_xyz" value="-0.172664 0.092664 0.023" />
    <xacro:property name="hip_5_rpy" value="0 0 ${3*pi/4}" />
    <xacro:property name="hip_6_xyz" value="-0.172664 -0.092664 0.023" />
    <xacro:property name="hip_6_rpy" value="0 0 ${-3*pi/4}" />

    <!-- Femur joint properties: displacement and rotation relative to the hip frame -->
    <xacro:property name="femur_xyz" value="0.0415 0 0" />
    <xacro:property name="femur_rpy" value="${-pi/2} 0 0" />

    <!-- Tibia joint properties: displacement and rotation relative to the femur frame -->
    <xacro:property name="tibia_xyz" value="0.078 0 0" />
    <xacro:property name="tibia_rpy" value="${pi} 0 0" />

    <!-- Foot tip joint properties: displacement and rotation relative to the tibia frame -->
    <xacro:property name="foot_tip_xyz" value="${0.0515+0.106*cos(-pi/9)} ${0.106*sin(-pi/9)} 0" />
    <xacro:property name="foot_tip_rpy" value="0 0 ${-pi/9}" />

    <!-- Servo limitations -->
    <xacro:property name="servo_lower" value="${-2*pi/3}" />
    <xacro:property name="servo_upper" value="${2*pi/3}" />
    <xacro:property name="servo_velocity" value="5.8178" />
    <xacro:property name="servo_effort" value="1.9613" />
    <xacro:macro name="servo_limit">
        <limit lower="${servo_lower}" upper="${servo_upper}" velocity="${servo_velocity}"
            effort="${servo_effort}" />
    </xacro:macro>

    <!-- Servo dynamics. Some random values right now -->
    <xacro:property name="joint_damping" value="0.01" />
    <xacro:property name="joint_friction" value="0.2" />
    <xacro:macro name="joint_dynamics">
        <dynamics damping="${joint_damping}" friction="${joint_friction}" />
    </xacro:macro>

    <!-- Macro for hip joint -->
    <xacro:macro name="hip_joint" params="suffix use_joint_dynamics">
        <joint name="hip_joint${suffix}" type="revolute">
            <parent link="base_link" />
            <child link="hip_link${suffix}" />
            <xacro:if value="${suffix == '_1'}">
                <origin xyz="${hip_1_xyz}" rpy="${hip_1_rpy}" />
            </xacro:if>
            <xacro:if value="${suffix == '_2'}">
                <origin xyz="${hip_2_xyz}" rpy="${hip_2_rpy}" />
            </xacro:if>
            <xacro:if value="${suffix == '_3'}">
                <origin xyz="${hip_3_xyz}" rpy="${hip_3_rpy}" />
            </xacro:if>
            <xacro:if value="${suffix == '_4'}">
                <origin xyz="${hip_4_xyz}" rpy="${hip_4_rpy}" />
            </xacro:if>
            <xacro:if value="${suffix == '_5'}">
                <origin xyz="${hip_5_xyz}" rpy="${hip_5_rpy}" />
            </xacro:if>
            <xacro:if value="${suffix == '_6'}">
                <origin xyz="${hip_6_xyz}" rpy="${hip_6_rpy}" />
            </xacro:if>
            <axis xyz="0 0 1" />
            <xacro:servo_limit />
            <xacro:if value="${use_joint_dynamics}">
                <xacro:joint_dynamics />
            </xacro:if>
        </joint>
    </xacro:macro>

    <!-- Macro for femur joint -->
    <xacro:macro name="femur_joint" params="suffix use_joint_dynamics">
        <joint name="femur_joint${suffix}" type="revolute">
            <parent link="hip_link${suffix}" />
            <child link="femur_link${suffix}" />
            <origin xyz="${femur_xyz}" rpy="${femur_rpy}" />
            <axis xyz="0 0 1" />
            <xacro:servo_limit />
            <xacro:if value="${use_joint_dynamics}">
                <xacro:joint_dynamics />
            </xacro:if>
        </joint>
    </xacro:macro>

    <!-- Macro for tibia joint -->
    <xacro:macro name="tibia_joint" params="suffix use_joint_dynamics">
        <joint name="tibia_joint${suffix}" type="revolute">
            <parent link="femur_link${suffix}" />
            <child link="tibia_link${suffix}" />
            <origin xyz="${tibia_xyz}" rpy="${tibia_rpy}" />
            <axis xyz="0 0 1" />
            <xacro:servo_limit />
            <xacro:if value="${use_joint_dynamics}">
                <xacro:joint_dynamics />
            </xacro:if>
        </joint>
    </xacro:macro>

    <!-- Macro for foot tip joint (fixed) -->
    <xacro:macro name="foot_tip_joint" params="suffix">
        <joint name="foot_tip_joint${suffix}" type="fixed">
            <parent link="tibia_link${suffix}" />
            <child link="foot_tip_link${suffix}" />
            <origin xyz="${foot_tip_xyz}" rpy="${foot_tip_rpy}" />
        </joint>
    </xacro:macro>

</robot>